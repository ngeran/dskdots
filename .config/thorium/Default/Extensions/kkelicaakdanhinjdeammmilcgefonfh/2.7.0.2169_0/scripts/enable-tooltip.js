var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
/// <reference path="../../typings/html5.d.ts" />
;
(function (context) {
    const POSITIONS = {
        center: 0,
        top: -1,
        left: -1,
        bottom: 1,
        right: 1,
    };
    const CONFIG = {
        WrapperID: 'window_resizer_tooltip_wrapper',
        StylesID: 'window_resizer_tooltip_styles',
        HideTimeout: 2000,
        ZoomFactor: 1,
        Position: ['bottom', 'right'],
    };
    const SLOTS = {
        WindowWidth: null,
        WindowHeight: null,
        ViewportWidth: null,
        ViewportHeight: null,
        CloseButton: null,
        SettingsButton: null,
    };
    const STATE = {
        NeedsUpdate: false,
        PendingHide: null,
    };
    const Runtime = {
        addEventListener: function (listener) {
            !chrome.runtime.onMessage.hasListener(listener) && chrome.runtime.onMessage.addListener(listener);
        },
        removeEventListener: function (listener) {
            try {
                chrome.runtime.onMessage.removeListener(listener);
            }
            catch (ex) { }
        },
        invoke: function (action, parameters) {
            return new Promise((resolve, reject) => {
                chrome.runtime.sendMessage({ action, parameters }, resolve);
            });
        },
        getURL: function (asset) {
            return chrome.runtime.getURL(asset);
        },
        extensionId: chrome.runtime.id,
    };
    let Tooltip = document.getElementById(CONFIG.WrapperID);
    let Styles = document.getElementById(CONFIG.StylesID);
    Tooltip && Tooltip.remove();
    Styles && Styles.remove();
    Promise.all([
        Runtime.invoke('tooltip-hide-delay'),
        Runtime.invoke('tooltip-position'),
        Runtime.invoke('get-zoom'),
    ]).then(([delay, position, zoom]) => {
        CONFIG.HideTimeout = delay.data;
        CONFIG.Position = position.data && position.data.length == 2 ? position.data : CONFIG.Position;
        CONFIG.ZoomFactor = context.devicePixelRatio / zoom.data;
        if (document.readyState !== 'complete') {
            document.addEventListener('readystatechange', _init);
        }
        else {
            _init();
        }
    });
    function _init() {
        return __awaiter(this, void 0, void 0, function* () {
            if (document.readyState !== 'complete') {
                return;
            }
            document.removeEventListener('readystatechange', _init);
            Styles = document.createElement('link');
            Styles.id = CONFIG.StylesID;
            Styles.rel = 'stylesheet';
            Styles.type = 'text/css';
            Styles.href = Runtime.getURL('assets/tpl/resize-tooltip.css');
            document.querySelector('head').appendChild(Styles);
            Tooltip = document.createElement('div');
            Tooltip.id = CONFIG.WrapperID;
            Tooltip.setAttribute('data-pos-y', CONFIG.Position[0]);
            Tooltip.setAttribute('data-pos-x', CONFIG.Position[1]);
            const TemplateSrc = yield (yield fetch(Runtime.getURL('assets/tpl/resize-tooltip.html'))).text();
            let ShadowRoot = Tooltip.attachShadow({ mode: 'closed' });
            ShadowRoot.innerHTML = TemplateSrc;
            // ShadowRoot.appendChild(document.importNode(template.content, true));
            ShadowRoot.querySelector('.logo').addEventListener('mousedown', _dragStart);
            SLOTS.WindowWidth = ShadowRoot.querySelector('.primary .width');
            SLOTS.WindowHeight = ShadowRoot.querySelector('.primary .height');
            SLOTS.ViewportWidth = ShadowRoot.querySelector('.secondary .width');
            SLOTS.ViewportHeight = ShadowRoot.querySelector('.secondary .height');
            SLOTS.CloseButton = ShadowRoot.querySelector('.close');
            SLOTS.SettingsButton = ShadowRoot.querySelector('.settings');
            document.body.appendChild(Tooltip);
            enable();
            function _dragStart(evt) {
                Tooltip.classList.add('dragging');
                document.addEventListener('mousemove', _dragUpdate);
                document.addEventListener('mouseup', _dragEnd);
                document.body.style.cursor = 'move';
            }
            function _dragEnd(evt) {
                Tooltip.classList.remove('dragging');
                document.removeEventListener('mousemove', _dragUpdate);
                document.removeEventListener('mouseup', _dragEnd);
                document.body.style.cursor = 'initial';
                Runtime.invoke('save-settings', {
                    tooltipPosition: CONFIG.Position,
                });
            }
            function _dragUpdate(evt) {
                if (!evt.clientX && !evt.clientY) {
                    return;
                }
                evt.stopPropagation();
                evt.preventDefault();
                let xSegment = window.innerWidth / 3;
                let ySegment = window.innerHeight / 3;
                let xAxis = 'left';
                let yAxis = 'top';
                if (evt.clientX > xSegment * 1)
                    xAxis = 'center';
                if (evt.clientX > xSegment * 2)
                    xAxis = 'right';
                if (evt.clientY > ySegment * 1)
                    yAxis = 'center';
                if (evt.clientY > ySegment * 2)
                    yAxis = 'bottom';
                CONFIG.Position[0] != yAxis && Tooltip.setAttribute('data-pos-y', yAxis);
                CONFIG.Position[1] != xAxis && Tooltip.setAttribute('data-pos-x', xAxis);
                if (CONFIG.Position[0] != yAxis || CONFIG.Position[1] != xAxis) {
                    CONFIG.Position = [yAxis, xAxis];
                    Tooltip.style.transform = _getTransform();
                }
            }
        });
    }
    function _toggleEventListeners(state) {
        let action = state ? 'addEventListener' : 'removeEventListener';
        Runtime[action](handleExtensionRequest);
        context[action]('resize', update, false);
        Tooltip[action]('mouseover', showOn);
        Tooltip[action]('mouseout', delayedHide);
        SLOTS.CloseButton[action]('click', disable);
        SLOTS.SettingsButton[action]('click', openSettings);
    }
    function _getTransform() {
        const scale = CONFIG.ZoomFactor / context.devicePixelRatio;
        const posY = POSITIONS[CONFIG.Position[0]];
        const posX = POSITIONS[CONFIG.Position[1]];
        let left = posX * -24 + ((window.innerWidth / scale) * (posX + 1)) / 2 - ((Tooltip.offsetWidth / scale) * (posX + 1)) / 2;
        let top = posY * -24 + ((window.innerHeight / scale) * (posY + 1)) / 2 - ((Tooltip.offsetHeight / scale) * (posY + 1)) / 2;
        return `scale(${scale}) translateY(${top}px) translateX(${left}px)`;
    }
    function enable() {
        // read the opacity to kick-start the initial CSS fade-in animation
        // (it wouldn't otherwise animate when adding the `.visible` class right after
        // appending the node to the body - most likely because of some Chrome bug)
        context.getComputedStyle(Tooltip).opacity;
        _toggleEventListeners(true);
        //show();
    }
    function disable() {
        _toggleEventListeners(false);
        hide().then(() => {
            Tooltip.remove();
            Tooltip = null;
            Styles.remove();
            Styles = null;
        });
    }
    function openSettings() {
        Runtime.invoke('open-settings', '#settings/tooltip');
    }
    function show(autoHide) {
        Tooltip.classList.add('visible');
        cancelDelayedHide();
        update();
        autoHide !== false && delayedHide();
    }
    function showOn() {
        show(false);
    }
    function hide() {
        Tooltip.classList.remove('visible');
        cancelDelayedHide();
        STATE.NeedsUpdate = false;
        return new Promise(done => setTimeout(done, 300));
    }
    function delayedHide() {
        cancelDelayedHide();
        STATE.PendingHide = setTimeout(hide, CONFIG.HideTimeout);
    }
    function cancelDelayedHide() {
        clearTimeout(STATE.PendingHide);
        STATE.PendingHide = null;
    }
    function update() {
        if (!Tooltip.parentNode) {
            disable();
            return;
        }
        if (!STATE.NeedsUpdate) {
            STATE.NeedsUpdate = true;
            context.requestAnimationFrame(_update);
        }
    }
    function _update() {
        STATE.NeedsUpdate = false;
        Tooltip.style.transform = _getTransform();
        SLOTS.WindowWidth.innerHTML = context.innerWidth;
        SLOTS.WindowHeight.innerHTML = context.innerHeight;
        SLOTS.ViewportWidth.innerHTML = context.outerWidth;
        SLOTS.ViewportHeight.innerHTML = context.outerHeight;
        !isVisible() && show();
    }
    function isVisible() {
        return Tooltip && Tooltip.classList.contains('visible');
    }
    function handleExtensionRequest(msg, sender, respond) {
        if (typeof msg === 'string') {
            msg = { command: msg };
        }
        switch (msg.command) {
            case 'STATUS':
                respond(isVisible() ? 'VISIBLE' : 'HIDDEN');
                break;
            case 'SET_HIDE_DELAY':
                CONFIG.HideTimeout = msg.delay || CONFIG.HideTimeout;
                break;
            case 'DISABLE':
                disable();
                break;
            case 'SHOW':
                show();
                break;
            case 'HIDE':
                hide();
                break;
            case 'TOGGLE':
                isVisible() ? hide() : show();
                break;
        }
    }
})(this);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9TY3JpcHRzL2VuYWJsZS10b29sdGlwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLGlEQUFpRDtBQUVqRCxDQUFDO0FBQUEsQ0FBQyxVQUFVLE9BQU87SUFDbEIsTUFBTSxTQUFTLEdBQUc7UUFDakIsTUFBTSxFQUFFLENBQUM7UUFDVCxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ1AsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNSLE1BQU0sRUFBRSxDQUFDO1FBQ1QsS0FBSyxFQUFFLENBQUM7S0FDUixDQUFBO0lBRUQsTUFBTSxNQUFNLEdBQUc7UUFDZCxTQUFTLEVBQUUsZ0NBQWdDO1FBQzNDLFFBQVEsRUFBRSwrQkFBK0I7UUFDekMsV0FBVyxFQUFFLElBQUk7UUFDakIsVUFBVSxFQUFFLENBQUM7UUFDYixRQUFRLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDO0tBQzdCLENBQUE7SUFFRCxNQUFNLEtBQUssR0FBRztRQUNiLFdBQVcsRUFBRSxJQUFJO1FBQ2pCLFlBQVksRUFBRSxJQUFJO1FBQ2xCLGFBQWEsRUFBRSxJQUFJO1FBQ25CLGNBQWMsRUFBRSxJQUFJO1FBQ3BCLFdBQVcsRUFBRSxJQUFJO1FBQ2pCLGNBQWMsRUFBRSxJQUFJO0tBQ3BCLENBQUE7SUFFRCxNQUFNLEtBQUssR0FBRztRQUNiLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLFdBQVcsRUFBRSxJQUFJO0tBQ2pCLENBQUE7SUFFRCxNQUFNLE9BQU8sR0FBRztRQUNmLGdCQUFnQixFQUFFLFVBQVUsUUFBUTtZQUNuQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDbEcsQ0FBQztRQUVELG1CQUFtQixFQUFFLFVBQVUsUUFBUTtZQUN0QyxJQUFJO2dCQUNILE1BQU0sQ0FBQyxPQUFPLENB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Ly8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9odG1sNS5kLnRzXCIgLz5cclxuXHJcbjsoZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuXHRjb25zdCBQT1NJVElPTlMgPSB7XHJcblx0XHRjZW50ZXI6IDAsXHJcblx0XHR0b3A6IC0xLFxyXG5cdFx0bGVmdDogLTEsXHJcblx0XHRib3R0b206IDEsXHJcblx0XHRyaWdodDogMSxcclxuXHR9XHJcblxyXG5cdGNvbnN0IENPTkZJRyA9IHtcclxuXHRcdFdyYXBwZXJJRDogJ3dpbmRvd19yZXNpemVyX3Rvb2x0aXBfd3JhcHBlcicsXHJcblx0XHRTdHlsZXNJRDogJ3dpbmRvd19yZXNpemVyX3Rvb2x0aXBfc3R5bGVzJyxcclxuXHRcdEhpZGVUaW1lb3V0OiAyMDAwLFxyXG5cdFx0Wm9vbUZhY3RvcjogMSxcclxuXHRcdFBvc2l0aW9uOiBbJ2JvdHRvbScsICdyaWdodCddLFxyXG5cdH1cclxuXHJcblx0Y29uc3QgU0xPVFMgPSB7XHJcblx0XHRXaW5kb3dXaWR0aDogbnVsbCxcclxuXHRcdFdpbmRvd0hlaWdodDogbnVsbCxcclxuXHRcdFZpZXdwb3J0V2lkdGg6IG51bGwsXHJcblx0XHRWaWV3cG9ydEhlaWdodDogbnVsbCxcclxuXHRcdENsb3NlQnV0dG9uOiBudWxsLFxyXG5cdFx0U2V0dGluZ3NCdXR0b246IG51bGwsXHJcblx0fVxyXG5cclxuXHRjb25zdCBTVEFURSA9IHtcclxuXHRcdE5lZWRzVXBkYXRlOiBmYWxzZSxcclxuXHRcdFBlbmRpbmdIaWRlOiBudWxsLFxyXG5cdH1cclxuXHJcblx0Y29uc3QgUnVudGltZSA9IHtcclxuXHRcdGFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIChsaXN0ZW5lcikge1xyXG5cdFx0XHQhY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmhhc0xpc3RlbmVyKGxpc3RlbmVyKSAmJiBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIobGlzdGVuZXIpXHJcblx0XHR9LFxyXG5cclxuXHRcdHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIChsaXN0ZW5lcikge1xyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdGNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcilcclxuXHRcdFx0fSBjYXRjaCAoZXgpIHt9XHJcblx0XHR9LFxyXG5cclxuXHRcdGludm9rZTogZnVuY3Rpb24gKGFjdGlvbiwgcGFyYW1ldGVycz8pIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHRcdFx0XHRjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7IGFjdGlvbiwgcGFyYW1ldGVycyB9LCByZXNvbHZlKVxyXG5cdFx0XHR9KVxyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRVUkw6IGZ1bmN0aW9uIChhc3NldCkge1xyXG5cdFx0XHRyZXR1cm4gY2hyb21lLnJ1bnRpbWUuZ2V0VVJMKGFzc2V0KVxyXG5cdFx0fSxcclxuXHJcblx0XHRleHRlbnNpb25JZDogY2hyb21lLnJ1bnRpbWUuaWQsXHJcblx0fVxyXG5cclxuXHRsZXQgVG9vbHRpcDogSFRNTEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ09ORklHLldyYXBwZXJJRClcclxuXHRsZXQgU3R5bGVzOiBIVE1MTGlua0VsZW1lbnQgPSA8SFRNTExpbmtFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENPTkZJRy5TdHlsZXNJRClcclxuXHJcblx0VG9vbHRpcCAmJiBUb29sdGlwLnJlbW92ZSgpXHJcblx0U3R5bGVzICYmIFN0eWxlcy5yZW1vdmUoKVxyXG5cclxuXHRQcm9taXNlLmFsbChbXHJcblx0XHRSdW50aW1lLmludm9rZSgndG9vbHRpcC1oaWRlLWRlbGF5JyksXHJcblx0XHRSdW50aW1lLmludm9rZSgndG9vbHRpcC1wb3NpdGlvbicpLFxyXG5cdFx0UnVudGltZS5pbnZva2UoJ2dldC16b29tJyksXHJcblx0XSkudGhlbigoW2RlbGF5LCBwb3NpdGlvbiwgem9vbV06IGFueSkgPT4ge1xyXG5cdFx0Q09ORklHLkhpZGVUaW1lb3V0ID0gZGVsYXkuZGF0YVxyXG5cdFx0Q09ORklHLlBvc2l0aW9uID0gcG9zaXRpb24uZGF0YSAmJiBwb3NpdGlvbi5kYXRhLmxlbmd0aCA9PSAyID8gcG9zaXRpb24uZGF0YSA6IENPTkZJRy5Qb3NpdGlvblxyXG5cdFx0Q09ORklHLlpvb21GYWN0b3IgPSBjb250ZXh0LmRldmljZVBpeGVsUmF0aW8gLyB6b29tLmRhdGFcclxuXHJcblx0XHRpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykge1xyXG5cdFx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgX2luaXQpXHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRfaW5pdCgpXHJcblx0XHR9XHJcblx0fSlcclxuXHJcblx0YXN5bmMgZnVuY3Rpb24gX2luaXQoKSB7XHJcblx0XHRpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykge1xyXG5cdFx0XHRyZXR1cm5cclxuXHRcdH1cclxuXHJcblx0XHRkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgX2luaXQpXHJcblxyXG5cdFx0U3R5bGVzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpXHJcblx0XHRTdHlsZXMuaWQgPSBDT05GSUcuU3R5bGVzSURcclxuXHRcdFN0eWxlcy5yZWwgPSAnc3R5bGVzaGVldCdcclxuXHRcdFN0eWxlcy50eXBlID0gJ3RleHQvY3NzJ1xyXG5cdFx0U3R5bGVzLmhyZWYgPSBSdW50aW1lLmdldFVSTCgnYXNzZXRzL3RwbC9yZXNpemUtdG9vbHRpcC5jc3MnKVxyXG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCcpLmFwcGVuZENoaWxkKFN0eWxlcylcclxuXHJcblx0XHRUb29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuXHRcdFRvb2x0aXAuaWQgPSBDT05GSUcuV3JhcHBlcklEXHJcblx0XHRUb29sdGlwLnNldEF0dHJpYnV0ZSgnZGF0YS1wb3MteScsIENPTkZJRy5Qb3NpdGlvblswXSlcclxuXHRcdFRvb2x0aXAuc2V0QXR0cmlidXRlKCdkYXRhLXBvcy14JywgQ09ORklHLlBvc2l0aW9uWzFdKVxyXG5cclxuXHRcdGNvbnN0IFRlbXBsYXRlU3JjID0gYXdhaXQgKGF3YWl0IGZldGNoKFJ1bnRpbWUuZ2V0VVJMKCdhc3NldHMvdHBsL3Jlc2l6ZS10b29sdGlwLmh0bWwnKSkpLnRleHQoKVxyXG5cdFx0bGV0IFNoYWRvd1Jvb3QgPSBUb29sdGlwLmF0dGFjaFNoYWRvdyh7IG1vZGU6ICdjbG9zZWQnIH0pXHJcblxyXG5cdFx0U2hhZG93Um9vdC5pbm5lckhUTUwgPSBUZW1wbGF0ZVNyY1xyXG5cclxuXHRcdC8vIFNoYWRvd1Jvb3QuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuaW1wb3J0Tm9kZSh0ZW1wbGF0ZS5jb250ZW50LCB0cnVlKSk7XHJcblx0XHRTaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoJy5sb2dvJykuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgX2RyYWdTdGFydClcclxuXHJcblx0XHRTTE9UUy5XaW5kb3dXaWR0aCA9IFNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLnByaW1hcnkgLndpZHRoJylcclxuXHRcdFNMT1RTLldpbmRvd0hlaWdodCA9IFNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLnByaW1hcnkgLmhlaWdodCcpXHJcblx0XHRTTE9UUy5WaWV3cG9ydFdpZHRoID0gU2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCcuc2Vjb25kYXJ5IC53aWR0aCcpXHJcblx0XHRTTE9UUy5WaWV3cG9ydEhlaWdodCA9IFNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLnNlY29uZGFyeSAuaGVpZ2h0JylcclxuXHRcdFNMT1RTLkNsb3NlQnV0dG9uID0gU2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCcuY2xvc2UnKVxyXG5cdFx0U0xPVFMuU2V0dGluZ3NCdXR0b24gPSBTaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoJy5zZXR0aW5ncycpXHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChUb29sdGlwKVxyXG5cdFx0ZW5hYmxlKClcclxuXHJcblx0XHRmdW5jdGlvbiBfZHJhZ1N0YXJ0KGV2dCkge1xyXG5cdFx0XHRUb29sdGlwLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJylcclxuXHRcdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgX2RyYWdVcGRhdGUpXHJcblx0XHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBfZHJhZ0VuZClcclxuXHRcdFx0ZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnbW92ZSdcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBfZHJhZ0VuZChldnQpIHtcclxuXHRcdFx0VG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpXHJcblx0XHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIF9kcmFnVXBkYXRlKVxyXG5cdFx0XHRkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgX2RyYWdFbmQpXHJcblx0XHRcdGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gJ2luaXRpYWwnXHJcblxyXG5cdFx0XHRSdW50aW1lLmludm9rZSgnc2F2ZS1zZXR0aW5ncycsIHtcclxuXHRcdFx0XHR0b29sdGlwUG9zaXRpb246IENPTkZJRy5Qb3NpdGlvbixcclxuXHRcdFx0fSlcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBfZHJhZ1VwZGF0ZShldnQpIHtcclxuXHRcdFx0aWYgKCFldnQuY2xpZW50WCAmJiAhZXZ0LmNsaWVudFkpIHtcclxuXHRcdFx0XHRyZXR1cm5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0ZXZ0LnN0b3BQcm9wYWdhdGlvbigpXHJcblx0XHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpXHJcblxyXG5cdFx0XHRsZXQgeFNlZ21lbnQgPSB3aW5kb3cuaW5uZXJXaWR0aCAvIDNcclxuXHRcdFx0bGV0IHlTZWdtZW50ID0gd2luZG93LmlubmVySGVpZ2h0IC8gM1xyXG5cdFx0XHRsZXQgeEF4aXMgPSAnbGVmdCdcclxuXHRcdFx0bGV0IHlBeGlzID0gJ3RvcCdcclxuXHJcblx0XHRcdGlmIChldnQuY2xpZW50WCA+IHhTZWdtZW50ICogMSkgeEF4aXMgPSAnY2VudGVyJ1xyXG5cdFx0XHRpZiAoZXZ0LmNsaWVudFggPiB4U2VnbWVudCAqIDIpIHhBeGlzID0gJ3JpZ2h0J1xyXG5cclxuXHRcdFx0aWYgKGV2dC5jbGllbnRZID4geVNlZ21lbnQgKiAxKSB5QXhpcyA9ICdjZW50ZXInXHJcblx0XHRcdGlmIChldnQuY2xpZW50WSA+IHlTZWdtZW50ICogMikgeUF4aXMgPSAnYm90dG9tJ1xyXG5cclxuXHRcdFx0Q09ORklHLlBvc2l0aW9uWzBdICE9IHlBeGlzICYmIFRvb2x0aXAuc2V0QXR0cmlidXRlKCdkYXRhLXBvcy15JywgeUF4aXMpXHJcblx0XHRcdENPTkZJRy5Qb3NpdGlvblsxXSAhPSB4QXhpcyAmJiBUb29sdGlwLnNldEF0dHJpYnV0ZSgnZGF0YS1wb3MteCcsIHhBeGlzKVxyXG5cclxuXHRcdFx0aWYgKENPTkZJRy5Qb3NpdGlvblswXSAhPSB5QXhpcyB8fCBDT05GSUcuUG9zaXRpb25bMV0gIT0geEF4aXMpIHtcclxuXHRcdFx0XHRDT05GSUcuUG9zaXRpb24gPSBbeUF4aXMsIHhBeGlzXVxyXG5cdFx0XHRcdFRvb2x0aXAuc3R5bGUudHJhbnNmb3JtID0gX2dldFRyYW5zZm9ybSgpXHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIF90b2dnbGVFdmVudExpc3RlbmVycyhzdGF0ZSkge1xyXG5cdFx0bGV0IGFjdGlvbiA9IHN0YXRlID8gJ2FkZEV2ZW50TGlzdGVuZXInIDogJ3JlbW92ZUV2ZW50TGlzdGVuZXInXHJcblxyXG5cdFx0UnVudGltZVthY3Rpb25dKGhhbmRsZUV4dGVuc2lvblJlcXVlc3QpXHJcblx0XHRjb250ZXh0W2FjdGlvbl0oJ3Jlc2l6ZScsIHVwZGF0ZSwgZmFsc2UpXHJcblx0XHRUb29sdGlwW2FjdGlvbl0oJ21vdXNlb3ZlcicsIHNob3dPbilcclxuXHRcdFRvb2x0aXBbYWN0aW9uXSgnbW91c2VvdXQnLCBkZWxheWVkSGlkZSlcclxuXHRcdFNMT1RTLkNsb3NlQnV0dG9uW2FjdGlvbl0oJ2NsaWNrJywgZGlzYWJsZSlcclxuXHRcdFNMT1RTLlNldHRpbmdzQnV0dG9uW2FjdGlvbl0oJ2NsaWNrJywgb3BlblNldHRpbmdzKVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gX2dldFRyYW5zZm9ybSgpIHtcclxuXHRcdGNvbnN0IHNjYWxlID0gQ09ORklHLlpvb21GYWN0b3IgLyBjb250ZXh0LmRldmljZVBpeGVsUmF0aW9cclxuXHRcdGNvbnN0IHBvc1kgPSBQT1NJVElPTlNbQ09ORklHLlBvc2l0aW9uWzBdXVxyXG5cdFx0Y29uc3QgcG9zWCA9IFBPU0lUSU9OU1tDT05GSUcuUG9zaXRpb25bMV1dXHJcblxyXG5cdFx0bGV0IGxlZnQgPVxyXG5cdFx0XHRwb3NYICogLTI0ICsgKCh3aW5kb3cuaW5uZXJXaWR0aCAvIHNjYWxlKSAqIChwb3NYICsgMSkpIC8gMiAtICgoVG9vbHRpcC5vZmZzZXRXaWR0aCAvIHNjYWxlKSAqIChwb3NYICsgMSkpIC8gMlxyXG5cdFx0bGV0IHRvcCA9XHJcblx0XHRcdHBvc1kgKiAtMjQgKyAoKHdpbmRvdy5pbm5lckhlaWdodCAvIHNjYWxlKSAqIChwb3NZICsgMSkpIC8gMiAtICgoVG9vbHRpcC5vZmZzZXRIZWlnaHQgLyBzY2FsZSkgKiAocG9zWSArIDEpKSAvIDJcclxuXHJcblx0XHRyZXR1cm4gYHNjYWxlKCR7c2NhbGV9KSB0cmFuc2xhdGVZKCR7dG9wfXB4KSB0cmFuc2xhdGVYKCR7bGVmdH1weClgXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBlbmFibGUoKSB7XHJcblx0XHQvLyByZWFkIHRoZSBvcGFjaXR5IHRvIGtpY2stc3RhcnQgdGhlIGluaXRpYWwgQ1NTIGZhZGUtaW4gYW5pbWF0aW9uXHJcblx0XHQvLyAoaXQgd291bGRuJ3Qgb3RoZXJ3aXNlIGFuaW1hdGUgd2hlbiBhZGRpbmcgdGhlIGAudmlzaWJsZWAgY2xhc3MgcmlnaHQgYWZ0ZXJcclxuXHRcdC8vIGFwcGVuZGluZyB0aGUgbm9kZSB0byB0aGUgYm9keSAtIG1vc3QgbGlrZWx5IGJlY2F1c2Ugb2Ygc29tZSBDaHJvbWUgYnVnKVxyXG5cdFx0Y29udGV4dC5nZXRDb21wdXRlZFN0eWxlKFRvb2x0aXApLm9wYWNpdHlcclxuXHJcblx0XHRfdG9nZ2xlRXZlbnRMaXN0ZW5lcnModHJ1ZSlcclxuXHRcdC8vc2hvdygpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZGlzYWJsZSgpIHtcclxuXHRcdF90b2dnbGVFdmVudExpc3RlbmVycyhmYWxzZSlcclxuXHRcdGhpZGUoKS50aGVuKCgpID0+IHtcclxuXHRcdFx0VG9vbHRpcC5yZW1vdmUoKVxyXG5cdFx0XHRUb29sdGlwID0gbnVsbFxyXG5cclxuXHRcdFx0U3R5bGVzLnJlbW92ZSgpXHJcblx0XHRcdFN0eWxlcyA9IG51bGxcclxuXHRcdH0pXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBvcGVuU2V0dGluZ3MoKSB7XHJcblx0XHRSdW50aW1lLmludm9rZSgnb3Blbi1zZXR0aW5ncycsICcjc2V0dGluZ3MvdG9vbHRpcCcpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzaG93KGF1dG9IaWRlPykge1xyXG5cdFx0VG9vbHRpcC5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJylcclxuXHRcdGNhbmNlbERlbGF5ZWRIaWRlKClcclxuXHRcdHVwZGF0ZSgpXHJcblxyXG5cdFx0YXV0b0hpZGUgIT09IGZhbHNlICYmIGRlbGF5ZWRIaWRlKClcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHNob3dPbigpIHtcclxuXHRcdHNob3coZmFsc2UpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoaWRlKCkge1xyXG5cdFx0VG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKCd2aXNpYmxlJylcclxuXHRcdGNhbmNlbERlbGF5ZWRIaWRlKClcclxuXHRcdFNUQVRFLk5lZWRzVXBkYXRlID0gZmFsc2VcclxuXHJcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZG9uZSA9PiBzZXRUaW1lb3V0KGRvbmUsIDMwMCkpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBkZWxheWVkSGlkZSgpIHtcclxuXHRcdGNhbmNlbERlbGF5ZWRIaWRlKClcclxuXHRcdFNUQVRFLlBlbmRpbmdIaWRlID0gc2V0VGltZW91dChoaWRlLCBDT05GSUcuSGlkZVRpbWVvdXQpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjYW5jZWxEZWxheWVkSGlkZSgpIHtcclxuXHRcdGNsZWFyVGltZW91dChTVEFURS5QZW5kaW5nSGlkZSlcclxuXHRcdFNUQVRFLlBlbmRpbmdIaWRlID0gbnVsbFxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gdXBkYXRlKCkge1xyXG5cdFx0aWYgKCFUb29sdGlwLnBhcmVudE5vZGUpIHtcclxuXHRcdFx0ZGlzYWJsZSgpXHJcblx0XHRcdHJldHVyblxyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghU1RBVEUuTmVlZHNVcGRhdGUpIHtcclxuXHRcdFx0U1RBVEUuTmVlZHNVcGRhdGUgPSB0cnVlXHJcblx0XHRcdGNvbnRleHQucmVxdWVzdEFuaW1hdGlvbkZyYW1lKF91cGRhdGUpXHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBfdXBkYXRlKCkge1xyXG5cdFx0U1RBVEUuTmVlZHNVcGRhdGUgPSBmYWxzZVxyXG5cclxuXHRcdFRvb2x0aXAuc3R5bGUudHJhbnNmb3JtID0gX2dldFRyYW5zZm9ybSgpXHJcblxyXG5cdFx0U0xPVFMuV2luZG93V2lkdGguaW5uZXJIVE1MID0gY29udGV4dC5pbm5lcldpZHRoXHJcblx0XHRTTE9UUy5XaW5kb3dIZWlnaHQuaW5uZXJIVE1MID0gY29udGV4dC5pbm5lckhlaWdodFxyXG5cdFx0U0xPVFMuVmlld3BvcnRXaWR0aC5pbm5lckhUTUwgPSBjb250ZXh0Lm91dGVyV2lkdGhcclxuXHRcdFNMT1RTLlZpZXdwb3J0SGVpZ2h0LmlubmVySFRNTCA9IGNvbnRleHQub3V0ZXJIZWlnaHRcclxuXHJcblx0XHQhaXNWaXNpYmxlKCkgJiYgc2hvdygpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBpc1Zpc2libGUoKSB7XHJcblx0XHRyZXR1cm4gVG9vbHRpcCAmJiBUb29sdGlwLmNsYXNzTGlzdC5jb250YWlucygndmlzaWJsZScpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVFeHRlbnNpb25SZXF1ZXN0KG1zZywgc2VuZGVyLCByZXNwb25kKSB7XHJcblx0XHRpZiAodHlwZW9mIG1zZyA9PT0gJ3N0cmluZycpIHtcclxuXHRcdFx0bXNnID0geyBjb21tYW5kOiBtc2cgfVxyXG5cdFx0fVxyXG5cclxuXHRcdHN3aXRjaCAobXNnLmNvbW1hbmQpIHtcclxuXHRcdFx0Y2FzZSAnU1RBVFVTJzpcclxuXHRcdFx0XHRyZXNwb25kKGlzVmlzaWJsZSgpID8gJ1ZJU0lCTEUnIDogJ0hJRERFTicpXHJcblx0XHRcdFx0YnJlYWtcclxuXHJcblx0XHRcdGNhc2UgJ1NFVF9ISURFX0RFTEFZJzpcclxuXHRcdFx0XHRDT05GSUcuSGlkZVRpbWVvdXQgPSBtc2cuZGVsYXkgfHwgQ09ORklHLkhpZGVUaW1lb3V0XHJcblx0XHRcdFx0YnJlYWtcclxuXHJcblx0XHRcdGNhc2UgJ0RJU0FCTEUnOlxyXG5cdFx0XHRcdGRpc2FibGUoKVxyXG5cdFx0XHRcdGJyZWFrXHJcblxyXG5cdFx0XHRjYXNlICdTSE9XJzpcclxuXHRcdFx0XHRzaG93KClcclxuXHRcdFx0XHRicmVha1xyXG5cclxuXHRcdFx0Y2FzZSAnSElERSc6XHJcblx0XHRcdFx0aGlkZSgpXHJcblx0XHRcdFx0YnJlYWtcclxuXHJcblx0XHRcdGNhc2UgJ1RPR0dMRSc6XHJcblx0XHRcdFx0aXNWaXNpYmxlKCkgPyBoaWRlKCkgOiBzaG93KClcclxuXHRcdFx0XHRicmVha1xyXG5cdFx0fVxyXG5cdH1cclxufSkodGhpcylcclxuIl19
